cmake_minimum_required(VERSION 3.0)
project(FFExample)
set(FFMPEG /home/slenderchat/FFExample/deps/ffmpeg)
set(X264 /home/slenderchat/FFExample/deps/x264)
set(FFMPEG_OPTS --enable-gpl --enable-small --disable-all --disable-doc --enable-avutil --enable-avcodec --enable-avformat --enable-swresample --enable-swscale --enable-encoder=libx264 --enable-decoder=h264 --enable-muxer=mp4 --enable-demuxer=mpegvideo --enable-filter=concat,scale --enable-parser=mpeg4video --enable-protocol=concat,file --enable-libx264 --arch=x86_64 --cross-prefix=x86_64-unknown-linux-musl- --target-os=linux --extra-cflags='-I../x264' --extra-ldflags='-L../x264' --enable-pic --enable-lto)
set(X264_OPTS --enable-static --enable-lto --enable-pic --enable-strip --cross-prefix=x86_64-unknown-linux-musl-)
include_directories(${FFMPEG})
find_library(avformat libavformat.a HINTS ${FFMPEG}/libavformat)
find_library(avcodec libavcodec.a HINTS ${FFMPEG}/libavcodec)
find_library(avutil libavutil.a HINTS ${FFMPEG}/libavutil)
find_library(swresample libswresample.a HINTS ${FFMPEG}/libswresample)
find_library(swscale libswscale.a HINTS ${FFMPEG}/libswscale)
find_library(x264 libx264.a HINTS ${X264})
add_custom_target(libx264-config DEPENDS ${X264}/config.h)
add_custom_target(libx264 DEPENDS ${X264}/libx264.a)
add_custom_target(libav-config DEPENDS ${FFMPEG}/config.h)
add_custom_target(libav-libs DEPENDS ${FFMPEG}/libavutil/libavutil.a ${FFMPEG}/libavformat/libavformat.a ${FFMPEG}/libavcodec/libavcodec.a ${FFMPEG}/libswresample/libswresample.a ${FFMPEG}/libswscale/libswscale.a)
add_custom_command(OUTPUT ${FFMPEG}/libavutil/libavutil.a ${FFMPEG}/libavformat/libavformat.a ${FFMPEG}/libavcodec/libavcodec.a ${FFMPEG}/libswresample/libswresample.a ${FFMPEG}/libswscale/libswscale.a COMMAND make DEPENDS ${FFMPEG}/config.h WORKING_DIRECTORY ${FFMPEG})
add_custom_command(OUTPUT ${FFMPEG}/config.h COMMAND ./configure ${FFMPEG_OPTS} DEPENDS ${FFMPEG}/configure libx264 WORKING_DIRECTORY ${FFMPEG})
add_custom_command(OUTPUT ${X264}/config.h COMMAND ./configure ${X264_OPTS} DEPENDS ${X264}/configure WORKING_DIRECTORY ${X264})
add_custom_command(OUTPUT ${X264}/libx264.a COMMAND make DEPENDS ${X264}/config.h WORKING_DIRECTORY ${X264})
add_executable(FFE FFExample.c)
add_dependencies(FFE libav-libs)
target_link_libraries(FFE -static ${avformat} ${avcodec} ${avutil} ${x264} ${swresample} ${swscale})